using <%= name %>.Common.Config;
using <%= name %>.Core.Clients;
using <%= name %>.Services.Services.Clients;
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.Caching.Memory;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Options;
using System;
using System.Net.Http;
using System.Net.Http.Headers;

namespace <%= name %>.Api.Core.Infrastructure
{
    public static class HttpClientStartUp
    {
        public static IServiceCollection AddHttpClientModule(this IServiceCollection @this, IConfiguration configurationt)
        {
            // HttpClientFactory
            @this.AddHttpClient("NovaAPI", client =>
            {
                client.BaseAddress = new Uri(configurationt["GateWayAPIServer"]);
                client.DefaultRequestHeaders
      .Accept
      .Add(new MediaTypeWithQualityHeaderValue("application/json"));//ACCEPT header
                //client.DefaultRequestHeaders.Add("X-Version", Configuration["X-VERSION"]);
            });

            // HttpClientFactory will take care of connection caching, ProjectsAPI is the name 
            // of the factory, just above.
            @this.AddSingleton<IHTTPClientHelper, HTTPClientHelper>(s =>
                new HTTPClientHelper(s.GetService<IHttpClientFactory>(), "NovaAPI", s.GetService<IMemoryCache>(), s.GetService<IOptions<NovaSettings>>())
                );
            return @this;

        }
    }
}
